<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- content-Type -->
<meta charset="utf-8">


<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="language" content="en">
<meta name="robots" content="all">


<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<meta content="email=no" name="format-detection">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



<meta name="author" content="theme.author, theme.email">
<meta name="reply-to" content="theme.email">
<meta name="owner" content="theme.author">













<meta name="description" content="Pober Wong">




<meta name="keywords" content="算法,被遗弃,">


<meta name="description" content="题目 Given a non negative integer number num. For every numbers i in the range 0 ≤ i ≤ num calculate the number of 1’s in their binary representation and return them as an array. Example: For num = 5 yo">
<meta name="keywords" content="算法,被遗弃">
<meta property="og:type" content="article">
<meta property="og:title" content="338. Counting Bits">
<meta property="og:url" content="http://poberwong.com/2016/08/25/338. Counting Bits/index.html">
<meta property="og:site_name" content="波波的小窝">
<meta property="og:description" content="题目 Given a non negative integer number num. For every numbers i in the range 0 ≤ i ≤ num calculate the number of 1’s in their binary representation and return them as an array. Example: For num = 5 yo">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/442688-afed8a78597a1d88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2016-10-11T04:10:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="338. Counting Bits">
<meta name="twitter:description" content="题目 Given a non negative integer number num. For every numbers i in the range 0 ≤ i ≤ num calculate the number of 1’s in their binary representation and return them as an array. Example: For num = 5 yo">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/442688-afed8a78597a1d88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">






  <link rel="shorticon icon" type="image/x-icon" href="/images/favicon.ico?v=0.0.1">






<link href="http://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.0.1">


<script>
(function(){
  var bp = document.createElement('script');
  bp.src = '//push.zhanzhang.baidu.com/push.js';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>

  <title> 338. Counting Bits </title>
  




</head>
<body lang="zh-Hans">

  <!--[if lte IE 9]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <div class="another-theme layout">

    
<header class="header" id="header">

  <div class="header-cont">
    <div class="text-area">
      
        <h1 class="title" data-text="338. Counting Bits"> 338. Counting Bits </h1>

        
        <div class="post-meta">
          <div class="post-time">
            发表于
            <time datetime="2016-08-25T00:17:09+08:00" content="2016-08-25">
              2016-08-25
            </time>
          </div>

          
            <div class="post-category">
              
                <span>
                  <a href="/categories#LeetCode OJ" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode OJ</span>
                  </a>
                </span>

                
                

              
            </div>
          

          
            
          
        </div>
        
      
    </div>
    <!-- Navigation -->
    
    <nav class="navigation clearfix" id="navigation">
      
        
        <a class="nav-link" href="/" rel="section">
          首页
        </a>
      
        
        <a class="nav-link" href="/categories" rel="section">
          分类
        </a>
      
        
        <a class="nav-link" href="/tags" rel="section">
          标签
        </a>
      
        
        <a class="nav-link" href="/about" rel="section">
          关于
        </a>
      
    </nav>
    
  </div>
  <div class="mask"></div>
</header>


    <main class="container">

      

  <article class="post-article post-type-normal post" itemscope>

  <div class="post-body">

    <div class="content markdown-body"><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><blockquote>
<p>Given a non negative integer number <strong>num</strong>. For every numbers <strong>i</strong> in the range <strong>0 ≤ i ≤ num</strong> calculate the number of 1’s in their binary representation and return them as an array.</p>
<p><strong>Example:</strong> For num = 5<br> you should return [0,1,1,2,1,2]</p>
<p><strong>Follow up:</strong><br>It is very easy to come up with a solution with run time <strong>O(n*sizeof(integer))</strong>. But can you do it in linear time <strong>O(n)</strong> /possibly in a single pass?<br>Space complexity should be <strong>O(n)</strong>.<br>Can you do it like a boss? Do it without using any builtin function like <strong>__builtin_popcount</strong> in c++ or in any other language.</p>
</blockquote>
<hr>
<p>这个题目大意是给定一个非负数num, 然后让我们计算0~num之间每一个数字的二进制表示中1的个数并以数组的形式返回。其中要求时间复杂度和空间复杂度均为O(n)。</p>
<h2 id="失败的解决案例"><a href="#失败的解决案例" class="headerlink" title="失败的解决案例"></a>失败的解决案例</h2><p>看到这个题目时，我第一时间想到的解决方案是:</p>
<ol>
<li>第一步毋庸置疑，一定是对0～num进行遍历，至于是for还是while循环都可以。</li>
<li>循环体中的操作<ul>
<li>将数字转换为二进制字符串 <code>num.toString(2)</code></li>
<li>对二进制字符串进行遍历，这里使用通用的<code>for...in</code>还是<code>Object.keys()</code>都可行。不过这里我们采用的是先用空串分割转换为数组之后，就可以直接使用数组的<code>forEach</code>方法进行遍历操作了</li>
<li>使用临时变量在循环体中对当前数字中1的个数进行统计，然后push进数组即可。</li>
</ul>
</li>
</ol>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight vim"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">countBits</span> <span class="params">(num)</span> &#123;</span></div><div class="line">    <span class="keyword">if</span> (!num &amp;&amp; num !== <span class="number">0</span>) <span class="keyword">return</span></div><div class="line">    <span class="keyword">let</span> result = []</div><div class="line">    <span class="keyword">while</span> (num &gt;= <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">let</span> <span class="built_in">count</span> = <span class="number">0</span></div><div class="line">        num.toString(<span class="number">2</span>).<span class="keyword">split</span>(<span class="string">''</span>).forEach(<span class="keyword">a</span> =&gt; <span class="keyword">a</span> === <span class="string">'1'</span> &amp;&amp; <span class="built_in">count</span>++)</div><div class="line">        result.unshift(<span class="built_in">count</span>)</div><div class="line">        num--</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不知大家有没有发现，该solution的时间复杂度因为两层的嵌套循环使得时间复杂度已经超越O(n^2)了, 由于里层循环的次数与n含有函数关系，暂且把它当作是O(n^2)的复杂度吧 !  结果可想而知，在OJ过程中没有被Accept……</p>
<p><strong><em>思考</em></strong> : 现在问题来了，如果要把时间复杂度控制在O(n)上，就意味着在外层必须要的循环里，要保证内层操作的时间复杂度为O(1)，也就意味着内层不能用循环来处理。</p>
<p>百思不得解后，很没出息的翻开了Hint提示，如下：</p>
<blockquote>
<ol>
<li>You should make use of what you have produced already.</li>
<li>Divide the numbers in ranges like [2-3], [4-7], [8-15] and so on. And try to generate new range from previous.</li>
<li>Or does the odd/even status of the number help you in calculating the number of 1s?</li>
</ol>
</blockquote>
<ol>
<li>你应该利用已经计算出的部分结果</li>
<li>[2-3], [4-7], [8-15] 以这个区间的形式对数字进行划分，并且尝试对前边已经利用过的数据进行重新分组</li>
<li>或者也可以对数字的奇偶性切入判断</li>
</ol>
<h2 id="官方建议解法一"><a href="#官方建议解法一" class="headerlink" title="官方建议解法一"></a>官方建议解法一</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析:"></a>分析:</h3><p>  第二条中讲到对数字进行分组，我们先通过js程序将0～32之间的数字的二进制值打印一下，分析一下结构规律：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="number">0</span>:      <span class="number">0000</span>    <span class="number">0001</span>   </div><div class="line"><span class="number">2</span>:      <span class="number">0010</span>    <span class="number">0011</span></div><div class="line"><span class="number">4</span>:      <span class="number">0100</span>    <span class="number">0101</span>     <span class="number">0110</span>     <span class="number">0111</span></div><div class="line"><span class="number">8</span>:      <span class="number">1000</span>    <span class="number">1001</span>     <span class="number">1010</span>     <span class="number">1011</span>    <span class="number">1100</span>    <span class="number">1101</span>    <span class="number">1110</span>    <span class="number">1111</span></div><div class="line"><span class="number">16</span>:    <span class="number">10000.</span>..</div></pre></td></tr></table></figure></p>
<p>将数据按照2的次幂分组后，发现每逢二的次幂，该行的数据全部跟前边若干行的数据有关，具体如下：<br><img src="http://upload-images.jianshu.io/upload_images/442688-afed8a78597a1d88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>总结上图规律：</p>
<ol>
<li>每行开头的值都是2的次幂，这意味着发生了总位数的增加。因为固定二进制位数能表示的范围是0～2^n－1。在最高位加了1后，后半部分(当前行)值的增长本质上是对前半部分的复制，也就是说抛开增长的最高位，后边的几位数盒前半部分值是完全相同的。</li>
<li>由此推断出当前行每一个数字中1的位数都比前半部分所对应的数字多1个(最高位)</li>
<li>我们只要抓准当前行的开始值，然后对前几行的数据从0开始记录，直到最后一个数字，依次加一即可完成对当前数字中1个数的推算。</li>
</ol>
<h3 id="Code："><a href="#Code：" class="headerlink" title="Code："></a>Code：</h3><figure class="highlight openscad"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">countBits</span> <span class="params">(num)</span> &#123;</span></div><div class="line">    <span class="built_in">let</span> result = [<span class="number">0</span>];</div><div class="line">    <span class="built_in">let</span> <span class="built_in">pow</span> = <span class="number">1</span></div><div class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> i = <span class="number">1</span>, t = <span class="number">0</span>; i &lt;= num; i++, t++) &#123;</div><div class="line">        <span class="keyword">if</span>(i == <span class="built_in">pow</span>) &#123; <span class="comment">// 抓取是否是行首值</span></div><div class="line">            <span class="built_in">pow</span> *= <span class="number">2</span></div><div class="line">            t = <span class="number">0</span> <span class="comment">// 对前半部分的纪录游标置零</span></div><div class="line">        &#125;</div><div class="line">        result[i] = result[t] + <span class="number">1</span> <span class="comment">// 对当前遍历中的每一个元素+1</span></div><div class="line">    &#125;</div><div class="line">    return result</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>直接看代码可能还是有难度的，通过分析之后，发现还是非常通读易懂的。</p>
<h2 id="官方建议解法二"><a href="#官方建议解法二" class="headerlink" title="官方建议解法二"></a>官方建议解法二</h2><p>本解法的途径则是根据数字的奇偶性来作为切入点</p>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><ol>
<li>妇孺皆知，偶数后必然是奇数，也就是最后一个二进制位是1，前几位都一样。</li>
<li>对一个偶数除2取整，则可以计算出与之对应<code>1</code>个数相同的数。这样不好理解也可以利用<code>&gt;&gt;</code>位运算的方式增强理解。对一个偶数(最低位为0)向右移动一位(除二)可以推理出与之相同1个数的数；对于奇数而言，其<code>1</code>个数的统计只比前一个大1。</li>
<li>列计算式： <code>re[i] = re[i / 2] + i % 2</code><br>Code: <figure class="highlight dart"><table><tr><td class="code"><pre><div class="line">public <span class="built_in">int</span>[] countBits(<span class="built_in">int</span> <span class="built_in">num</span>) &#123;</div><div class="line">        <span class="built_in">int</span>[] f = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="built_in">num</span> + <span class="number">1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">1</span>; i&lt;=<span class="built_in">num</span>; i++) f[i] = f[i &gt;&gt; <span class="number">1</span>] + (i &amp; <span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> f;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>小记</strong>：</p>
<ol>
<li>这里的运算方式中，取余时采用了’&amp;’，位运算的乘法，这也是取出最低位数字(余数)的一种较为简便的方<br>式。</li>
<li>由于Javascript中没有取整运算，因此如果用Javascript作为语言的话，如果不用位运算，就得要用以下几种函数了：<ul>
<li><code>Math.floor(num)</code> 向下取整</li>
<li><code>Math.ceil(num)</code> 向上取整</li>
<li><code>parseInt(num)</code> 向下取整</li>
<li><code>Math.round(num)</code> 四舍五入</li>
<li><code>num.toFixed(x)</code> 选择保留小数位数，取值遵循四舍五入</li>
</ul>
</li>
</ol>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ul>
<li>寻找规律</li>
<li>利用双游标进行判断对比，第一个游标完成对前半部分的遍历，同时平行生成后半部分数据，从而达到O(n)的时间复杂度</li>
<li>Coding…</li>
</ul>
</div>

    <div class="post-sidebar">
  <div class="toggle-btn" id="toggle-btn">
    <i class="fa fa-reorder"></i>
  </div>
  <section class="post-toc-wrap" id="post-sidebar">
    <h2 class="toc-title">内容目录</h2>
    <div class="post-toc">
      
      
        <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目"><span class="nav-text">题目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#失败的解决案例"><span class="nav-text">失败的解决案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Code"><span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#官方建议解法一"><span class="nav-text">官方建议解法一</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分析"><span class="nav-text">分析:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Code："><span class="nav-text">Code：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#官方建议解法二"><span class="nav-text">官方建议解法二</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分析-1"><span class="nav-text">分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结："><span class="nav-text">总结：</span></a></li></ol></div>
      
    </div>
  </section>
</div>


  </div>

  <footer class="post-footer">
    
      <div class="post-tags">
        
          <a href="/tags#算法" rel="tag">#算法</a>
        
          <a href="/tags#被遗弃" rel="tag">#被遗弃</a>
        
      </div>
    
    
  <style>
    .donation {
      width: 100%;
      margin-top: 2rem;
    }
    .donation .text {
      color: #333;
      font-size: .8rem;
      cursor: pointer;
      text-decoration: underline;
    }
    .donation .text:hover {
      color: rgb(63,134,181);
    }
    .donation .img-box {
      transition: all .3s;
      width: 0;
      height: 0;
      margin: 1rem auto;
      overflow: hidden;
    }
    .donation .img-box img {
      width: 100%;
      height: 100%;
    }
    .donation #donation {
      display: none;
    }
    .donation #donation:checked + .img-box {
      width: 16rem;
      height: 16rem;
    }
  </style>
  <div class="donation">
    <label class="text" for="donation">
      如果你觉得文章对你有帮助，并且想为我买一杯咖啡，点这里～
    </label>
    <input type="checkbox" name="donation" id="donation">
    <div class="img-box">
      <img src="/images/pay.ali.png" alt="donation">
    </div>
    
  </div>


  </footer>

</article>




      
  <div class="comments" id="comments">
    
  </div>




    </main>

    <footer class="footer clearfix">
  <div class="copyright">
    <span>Copyright</span>
    
    &copy;  2015-
    <span itemprop="copyrightYear">2019</span>
    <span class="author" itemprop="copyrightHolder">Pober Wong</span>
  </div>

  <div class="info">
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
      <span id="showDays" class="show-days"></span>
      <script>
      var birthDay = new Date('7/20/2015');
      var now = new Date();
      var duration = now.getTime() - birthDay.getTime();
      var total= Math.floor(duration / (1000 * 60 * 60 * 24));
      document.getElementById("showDays").innerHTML = "本站已运行 "+total+" 天";
      </script>
      ---
    
    <span id="busuanzi_container_site_pv">
        总访问量<span id="busuanzi_value_site_pv"></span>次
    </span>
  </div>

  <div class="my-theme">
    Theme by <a href="//qiutc.me">qiutc</a> | <iframe style="margin-left: 5px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=TongchengQiu&amp;repo=hexo-theme-another&amp;type=star&amp;count=true"></iframe>
  </div>

</footer>


  </div>

  <div class="back-top-btn" id="back-top-btn"><i class="fa fa-chevron-up"></i></div>






  





<script type="text/javascript" src="/js/motto.min.js?v=0.0.1"></script>
<script type="text/javascript" src="/js/main.js?v=0.0.1"></script>


</body>
</html>
